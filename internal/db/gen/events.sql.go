// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: events.sql

package dbgen

import (
	"context"
)

const cleanupEvents = `-- name: CleanupEvents :exec
DELETE FROM events
WHERE created_at < now() - make_interval(secs => $1::int)
`

func (q *Queries) CleanupEvents(ctx context.Context, ttlSeconds int32) error {
	_, err := q.db.Exec(ctx, cleanupEvents, ttlSeconds)
	return err
}

const createEvent = `-- name: CreateEvent :one
INSERT INTO events (event_name, payload)
VALUES ($1, $2)
RETURNING id, event_name, payload, created_at
`

type CreateEventParams struct {
	EventName string `json:"event_name"`
	Payload   []byte `json:"payload"`
}

func (q *Queries) CreateEvent(ctx context.Context, arg CreateEventParams) (Event, error) {
	row := q.db.QueryRow(ctx, createEvent, arg.EventName, arg.Payload)
	var i Event
	err := row.Scan(
		&i.ID,
		&i.EventName,
		&i.Payload,
		&i.CreatedAt,
	)
	return i, err
}

const getEventByName = `-- name: GetEventByName :one
SELECT id, event_name, payload, created_at FROM events
WHERE event_name = $1
ORDER BY created_at DESC
LIMIT 1
`

func (q *Queries) GetEventByName(ctx context.Context, eventName string) (Event, error) {
	row := q.db.QueryRow(ctx, getEventByName, eventName)
	var i Event
	err := row.Scan(
		&i.ID,
		&i.EventName,
		&i.Payload,
		&i.CreatedAt,
	)
	return i, err
}
